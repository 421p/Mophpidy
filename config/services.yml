parameters:
  keyboard.default:
    -
      - '‚ù§Ô∏è Favorites'
      - 'üìÇ Browse'
    -
      - '‚óÄÔ∏èPrevious'
      - '‚ñ∂Ô∏èPlay'
      - '‚è∏Ô∏èPause'
      - '‚ñ∂Ô∏èNext'
    -
      - 'üîà Volume down'
      - 'üîä Volume up'

services:
  React\EventLoop\LoopInterface:
    public: true
    factory: ['React\EventLoop\Factory', create]

  Mophpidy\Api\Endpoint:
    arguments: ['%env(MOPIDY_URI)%', '@React\EventLoop\LoopInterface']
    calls:
      - ['connect']
  Mophpidy\Api\TrackList:
    arguments: ['@Mophpidy\Api\Endpoint']
  Mophpidy\Api\Library:
    arguments: ['@Mophpidy\Api\Endpoint']
  Mophpidy\Api\Playback:
    arguments: ['@Mophpidy\Api\Endpoint']
  Mophpidy\Api\Mixer:
    arguments: ['@Mophpidy\Api\Endpoint']

  Mophpidy\Api\Player:
    public: true
    arguments:
      - '@Mophpidy\Api\Library'
      - '@Mophpidy\Api\TrackList'
      - '@Mophpidy\Api\Playback'
      - '@Mophpidy\Api\Mixer'
      - '@Mophpidy\Api\Endpoint'
      - '@Mophpidy\Telegram\TelegramCommunicator'
      - '@Mophpidy\Storage\Storage'
    calls:
      - ['listenGeneralEvents']

  Longman\TelegramBot\Telegram:
    public: true
    class: 'Mophpidy\Telegram\Telegram'
    arguments: ['%env(TELEGRAM_TOKEN)%', '%env(BOT_USERNAME)%', '@React\EventLoop\LoopInterface']
    calls:
      - ['useGetUpdatesWithoutDatabase']

  Mophpidy\Telegram\TelegramCommunicator:
    public: true
    arguments:
      - '%env(TELEGRAM_TOKEN)%'
      - '@React\EventLoop\LoopInterface'
      - '%keyboard.default%'
      - '@Mophpidy\Api\TrackList'
      - '@Mophpidy\Api\Playback'

  Mophpidy\Command\CommandHolder:
    calls:
      - ['cacheCommands']
    public: true

  Mophpidy\Telegram\Callback\CallbackStorage:
    arguments: ['@React\EventLoop\LoopInterface']
    public: true

  Mophpidy\Storage\Storage:
    public: true
    arguments: ['@Doctrine\ORM\EntityManager']

  Doctrine\ORM\EntityManager:
    public: true
    factory:
      - 'Doctrine\ORM\EntityManager'
      - 'create'
    arguments:
      -
        driver: pdo_sqlite
        path: db.sqlite3
      - '@Doctrine\ORM\Configuration'
  Doctrine\ORM\Configuration:
    factory:
      - 'Doctrine\ORM\Tools\Setup'
      - 'createAnnotationMetadataConfiguration'
    arguments: [['src/Entity'], true, null, null, false]