parameters:
  keyboard.default:
    -
      - '‚ù§Ô∏è Favorites'
      - 'üö¶ Queue'
      - 'üìÇ Browse'
    -
      - '‚óÄÔ∏èPrevious'
      - '‚ñ∂Ô∏èPlay'
      - '‚è∏Ô∏èPause'
      - '‚ñ∂Ô∏èNext'
    -
      - 'üîà Volume down'
      - 'üîä Volume up'
  not.allowed: |
    You are not allowed to access this bot.
    Try to /requestaccess

services:
  React\EventLoop\LoopInterface:
    public: true
    factory: ['React\EventLoop\Factory', create]

  Mophpidy\Api\Endpoint:
    arguments: ['%env(MOPIDY_URI)%', '@React\EventLoop\LoopInterface']
    calls:
      - ['connect']
  Mophpidy\Api\TrackList:
    arguments: ['@Mophpidy\Api\Endpoint']
  Mophpidy\Api\Library:
    arguments: ['@Mophpidy\Api\Endpoint']
  Mophpidy\Api\Playback:
    arguments: ['@Mophpidy\Api\Endpoint']
  Mophpidy\Api\Mixer:
    arguments: ['@Mophpidy\Api\Endpoint']

  Mophpidy\Api\Player:
    public: true
    arguments:
      - '@Mophpidy\Api\Library'
      - '@Mophpidy\Api\TrackList'
      - '@Mophpidy\Api\Playback'
      - '@Mophpidy\Api\Mixer'
      - '@Mophpidy\Api\Endpoint'
      - '@Mophpidy\Telegram\TelegramCommunicator'
    calls:
      - ['listenGeneralEvents', ['@service_container']]

  Longman\TelegramBot\Telegram:
    public: true
    class: 'Mophpidy\Telegram\Telegram'
    arguments: ['%env(TELEGRAM_TOKEN)%', '%env(BOT_USERNAME)%', '@React\EventLoop\LoopInterface']
    calls:
      - ['useGetUpdatesWithoutDatabase']

  Mophpidy\Telegram\TelegramCommunicator:
    public: true
    arguments:
      - '%env(TELEGRAM_TOKEN)%'
      - '@React\EventLoop\LoopInterface'
      - '%keyboard.default%'
      - '@Mophpidy\Api\TrackList'
      - '@Mophpidy\Api\Playback'

  Mophpidy\Command\CommandHolder:
    calls:
      - ['cacheCommands']
    public: true

  Mophpidy\Telegram\Callback\CallbackStorage:
    arguments: ['@React\EventLoop\LoopInterface']
    public: true

  Mophpidy\Storage\Storage:
    public: true
    shared: false
    arguments: ['@Doctrine\ORM\EntityManager']
    calls:
      - ['updateAdmins']

  Doctrine\ORM\EntityManager:
    shared: false
    public: true
    factory:
      - 'Doctrine\ORM\EntityManager'
      - 'create'
    arguments:
      -
        driver: pdo_mysql
        host: mysql
        user: root
        password: secure-password
        dbname: mophpidy
        server_version: 8.0.11
      - '@Doctrine\ORM\Configuration'
  Doctrine\ORM\Configuration:
    factory:
      - 'Doctrine\ORM\Tools\Setup'
      - 'createAnnotationMetadataConfiguration'
    arguments: [['src/Entity'], true, null, '@Doctrine\Common\Cache\RedisCache', false]

  Redis:
    class: Redis
    calls:
      - [connect, ['redis', 6379]]
  Doctrine\Common\Cache\RedisCache:
    calls:
      - [setRedis, ['@Redis']]