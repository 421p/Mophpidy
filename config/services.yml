parameters:
  redis.connection_string: '%env(REDIS_CONNECTION_STRING)%'
  keyboard.default:
    -
      - '‚ù§Ô∏è Favorites'
      - 'üö¶ Queue'
      - 'üìÇ Browse'
    -
      - '‚óÄÔ∏èPrevious'
      - '‚ñ∂Ô∏èPlay'
      - '‚è∏Ô∏èPause'
      - '‚ñ∂Ô∏èNext'
    -
      - 'üîà Volume down'
      - 'üîä Volume up'
  not.allowed: |
    You are not allowed to access this bot.
    Try to /requestaccess

services:
  React\EventLoop\LoopInterface:
    public: true
    factory: ['React\EventLoop\Factory', create]

  Mophpidy\Api\Endpoint:
    arguments: ['%env(MOPIDY_URI)%', '@React\EventLoop\LoopInterface']
    calls:
      - ['connect']
  Mophpidy\Api\TrackList:
    arguments: ['@Mophpidy\Api\Endpoint']
  Mophpidy\Api\Library:
    arguments: ['@Mophpidy\Api\Endpoint']
  Mophpidy\Api\Playback:
    arguments: ['@Mophpidy\Api\Endpoint']
  Mophpidy\Api\Mixer:
    arguments: ['@Mophpidy\Api\Endpoint']

  Mophpidy\Api\Player:
    public: true
    arguments:
      - '@Mophpidy\Api\Library'
      - '@Mophpidy\Api\TrackList'
      - '@Mophpidy\Api\Playback'
      - '@Mophpidy\Api\Mixer'
      - '@Mophpidy\Api\Endpoint'
      - '@Mophpidy\Telegram\TelegramCommunicator'
      - '@Mophpidy\Storage\Storage'
    calls:
      - ['listenGeneralEvents']

  Longman\TelegramBot\Telegram:
    public: true
    class: 'Mophpidy\Telegram\Telegram'
    arguments: ['%env(TELEGRAM_TOKEN)%', '%env(BOT_USERNAME)%', '@React\EventLoop\LoopInterface']
    calls:
      - ['useGetUpdatesWithoutDatabase']

  Mophpidy\Telegram\TelegramCommunicator:
    public: true
    arguments:
      - '%env(TELEGRAM_TOKEN)%'
      - '@React\EventLoop\LoopInterface'
      - '%keyboard.default%'
      - '@Mophpidy\Api\TrackList'
      - '@Mophpidy\Api\Playback'

  Mophpidy\Command\CommandHolder:
    calls:
      - ['cacheCommands']
    public: true

  Mophpidy\Storage\Storage:
    public: true
    arguments: ['@Mophpidy\Storage\Redis\RedisPromise', '@Mophpidy\Storage\Redis\RedisPromise']
    calls:
      - ['updateAdmins']

  Mophpidy\Storage\Redis\RedisPromise:
    shared: false
    factory: ['@Mophpidy\Storage\Redis\RedisFactory', create]
    arguments: ['%redis.connection_string%']
  Mophpidy\Storage\Redis\RedisFactory:
    arguments: ['@React\EventLoop\LoopInterface']